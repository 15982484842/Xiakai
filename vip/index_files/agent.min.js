!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.Agent=t()}(this,function(){function n(n,t,e){var i=M[H];return!(!i||!i[Q])&&(arguments.length&&i[Q](F(n),t,e),!0)}function t(n,t,e){return["dopay","doRnAuth","doBindCard"].indexOf(n)===-1||d(t)||t.orderInfo||(t={orderInfo:t,showDialog:!1}),n!==Q&&(t.method_name=n),t.agentcuid=e,t}function e(n,t,e){var i=p("script");i.onload=i.onerror=function(n){"error"===n.type?e():t(),i=i.onload=i.onerror=null},i.src=n,V.head.appendChild(i)}function i(n,t){if(t&&Y("[ Agent ] ",n),sn.debug&&!t)return Y("[ Agent ] ",n),l(sn.debug,"function")?sn.debug(n):alert(F(n,null,4))}function o(n,t){for(var e=Object.keys(n),i=e.length;i--;)t[e[i]]=n[e[i]];return t}function r(n){var t={};return n=n.substr(0,n.length-1),v(n.split("};"),function(n){if(n){var e=n.split("={");t[e[0].replace("{","")]=e[1].replace(/}/g,"")}}),t}function a(n,t){return M.setTimeout(function(){return n()},t||1)}function u(n){return n.replace(un,c)}function c(n){return n?n.toUpperCase():""}function f(n,t){v(n,function(n,e){M[t?t(e):e]=n})}function s(){}function l(n,t){var e=Object.prototype.toString.call(n).replace(/\[\object|\]|\s/gi,"").toLowerCase();return t?e===t:e}function d(n){return l(n,"undefined")}function p(n){return V.createElement(n)}function v(n,t){for(var e in n)if(n.hasOwnProperty(e)&&t(n[e],e,n)===!1)break}function h(){return"a"+cn++}function y(n){var t,e={},i=l(n);"object"!==i?"string"===i&&(e[n]=arguments[1]):e=n,v(e,function(n,e){t=sn[e],t&&l(t,"object")?o(n,t):sn[e]=n})}function m(n){en()?n():"pending"===sn.readyState&&ln.on("error",n)}function g(n){var t=p("iframe");t.src=n,t.style.width=t.style.height=0,t.style.visibility="hidden",V.documentElement.appendChild(t),a(function(){t.parentNode.removeChild(t),t=null})}function b(){M[nn]&&J.ios&&J.wallet&&(M[nn].invoke=function(n,t,e,i,o){n||(n="defaultCommand"),t||(t={});var r=this;r.callbackId++,r.callbacks[r.callbackId]={success:e,fail:i},g(X+n+o+"/"+F(t))})}function k(n){return{s:_.call(this,"s",n),f:_.call(this,"f",n)}}function _(n,t,e){var i=this,o=i.expando,u=o?o[n]:h();return pn.proxy[n][u]=function(i){var c;i=d(i)?"":i;try{i=z(i)}catch(n){c=!0}if(c)try{i=r(i)}catch(n){}a(function(){t&&t({type:"s"==n?"success":"fail",data:i}),e||(o?(delete pn.proxy.s[o.s],delete pn.proxy.f[o.f]):delete pn.proxy[n][u])})},["Agent","proxy",n,u].join(".")}function w(t,e,i,o){rn()||o?g(X+Q+"?/"+F({successcallback:K(e),errorcallback:K(i),options:K(K(F(t)))})):n(t,e,i)}function x(){O(vn),ln.events.ready?ln.events.ready.unshift(b):ln.on("ready",b),!yn&&A({type:"first"}),I()}function I(){if(!~_n.indexOf(Z))return _n.length<(yn?1:2)?a(function(){I()},1e3):void a(function(){_n.indexOf(Z)===-1&&A({type:"pending"})},xn+1)}function A(n){var t=n.type;if(i("Check event: "+n.type,!0),_n.push(t),kn++,["complete","load"].indexOf(t)!=-1&&yn&&!on())return wn=a(function(){on()||A({type:"hold"})},function(){return"complete"==t?1:xn}());if(t===Z&&G(wn),M[H])C();else{if(kn===bn)return a(function(){A({type:"latest"})},500);if(kn>bn){if(J.box||J.licai)return S();e("https://gss0.bdstatic.com/6eR1bjq8AAUYm2zgoY3K/cdn-www.baifubao.com/static/agentjs/dist/"+(yn?"ios.js":"android.js"),function(){i("patch",!0),!M[H]&&S()},S)}}}function S(){ln.off("ready"),D("error")}function C(){ln.off("error"),D("ready")}function D(n){G(wn),j(vn),A=function(){},sn.readyState=n,ln.emit(n)}function O(n){v(n,function(n){"load"===n&&mn.test(V.readyState)?a(function(){A({type:V.readyState})}):P(n,"add")})}function j(n){v(n,function(n){P(n,"remove")})}function P(n,t){("load"===n?M:V)[t+"EventListener"](n,A)}function B(n){on()?n():"pending"===sn.readyState&&ln.on("ready",n)}function E(n){return rn()?sn._manual.indexOf(n)!==-1:M[H][n]}function T(n){return n=n||{},v(fn,function(t,e){d(n[e])&&(n[e]=fn[e])}),n}function U(n,t,e){return l(t,"function")?pn[n]=t:void(pn[n]=function(i){if(i=T(i),tn){var o=i.param,r=sn.clouds[an(t)&&o?i.param.method_name:t];if(r)return r.call(pn,o)}return en()?i.error.call(pn,{type:"NLB"}):void B(function(){return E(t)?void new Sn({api:n,actualApi:t,options:i,factory:e}).init():i.error({type:"error"})})})}function R(n){var t=Dn.href;n===t?Dn.reload():Dn.href=n}function L(n,t,e){l(t,"function")&&(e=t,t={}),e=e||s;var i=this;if(i[n])i[n]({param:t,success:function(n){e(null,n.data)},error:function(n){e(n)}});else{var o=l(t);if("object"!==o){if("undefined"!==o)return e({type:"abort"});t={}}t.method_name=n,i[Q]({param:t,success:function(n){e(null,n.data)},error:function(n){e(n)}})}}function N(n){n._installed||(sn.plugins.push(function(n){return n=o(n,{before:s,enter:s,finish:s}),function(){var t=this;v(n,function(n,e){t[e]=n}),t._inactive=!1}}(n)),n._installed=!0)}function q(n){return n.substr(0,32)+n.substr(n.indexOf("|"),n.length)}var W=navigator.userAgent,J={android:/(Android);?\s+([\d.]+)?/.test(W),ios:/(iPhone|iPod|iPad)/.test(W),wallet:/baiduwallet/gi.test(W),box:/baiduboxapp/gi.test(W),licai:/baidulicaiapp/gi.test(W)},M=window,V=document,Y=M.console.log.bind(M.console),z=JSON.parse,F=JSON.stringify,G=M.clearTimeout,K=M.encodeURIComponent,Q="invokeBdWalletNative",H="BLightApp",X="baiduwallet://",Z="runtimeready",$="console.log",nn="bba_la_node",tn=!J.wallet&&!J.box,en=function(){return"error"===sn.readyState},on=function(){return"ready"===sn.readyState},rn=function(){return!!sn._manual},an=function(n){return n===Q},un=/(?:^|[-_\/])(\w)/g,cn=0,fn={before:s,success:s,error:s,store:!1,timeout:null},sn={debug:!1,readyState:"pending",handshake:{},plugins:[],clouds:{},globalSettings:fn},ln={events:{}},dn=ln.events;ln.on=function(n,t){var e=dn[n]||(dn[n]=[]);return e.push(t),ln},ln.off=function(n,t){if(!n&&!t)return dn=ln.events={},ln;var e=dn[n];if(e)if(t)for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1);else delete dn[n];return ln},ln.emit=function(n,t){var e=dn[n];if(e){e=e.slice();for(var i=0,o=e.length;i<o;i++)e[i](t)}return ln};var pn={OS:J,error:m,proxy:{s:{},f:{}},config:y,loadScript:e},vn=["load",Z],hn=J.wallet,yn=J.ios,mn=/complete|loaded/,gn=yn?0:1,bn=vn.length+gn,kn=0,_n=[],wn=null,xn=yn?5e3:1e3;hn||J.box?J.android||J.box||J.licai?x():!function(){var n=a(function(){G(n),x()},600),t=function(t){G(n),t=t.data,!t||t&&0!=t.result?x():a(function(){sn._manual=t.cnt.data,C()})},e=k(t);a(function(){w({method_name:"getSupportedMethodList"},e.s,e.f,!0)},0)}():a(function(){S()});var In=(function(){function n(n){this.value=n}function t(t){function e(n,t){return new Promise(function(e,o){var u={key:n,arg:t,resolve:e,reject:o,next:null};a?a=a.next=u:(r=a=u,i(n,t))})}function i(e,r){try{var a=t[e](r),u=a.value;u instanceof n?Promise.resolve(u.value).then(function(n){i("next",n)},function(n){i("throw",n)}):o(a.done?"return":"normal",a.value)}catch(n){o("throw",n)}}function o(n,t){switch(n){case"return":r.resolve({value:t,done:!0});break;case"throw":r.reject(t);break;default:r.resolve({value:t,done:!1})}r=r.next,r?i(r.key,r.arg):a=null}var r,a;this._invoke=e,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(n){return this._invoke("next",n)},t.prototype.throw=function(n){return this._invoke("throw",n)},t.prototype.return=function(n){return this._invoke("return",n)},{wrap:function(n){return function(){return new t(n.apply(this,arguments))}},await:function(t){return new n(t)}}}(),function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}),An=function(){function n(n,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}();f({onBDWalletCallbackProxy:function(n){var t=sn.handshake[n];t&&t.onEntry&&t.onEntry()}});var Sn=function(){function e(n){In(this,e);var t=this;t.api=n.api,t.actualApi=n.actualApi,t.options=n.options,t.factory=n.factory,t.uid=h(),t.expando={s:h(),f:h()},t.plugins=function(n){return n?n.map(function(n){return new n}):[]}(sn.plugins),t.proxy=k.call(t,t.onResponse.bind(t)),t._inactive=!1,sn.handshake[t.uid]=t}return An(e,[{key:"abort",value:function(n){var t=this;t._inactive||(t._inactive=!0,t.report(n||"abort"))}},{key:"report",value:function(n){var t=this;t.options.error({type:n}),a(function(){t.destroy()},0)}},{key:"init",value:function(){var e=this,i=e.actualApi;if(e.param=d(e.options.param)?{}:e.options.param,(rn()||n())&&(e.param=t(i,e.param,e.uid)),an(i)){var o=e.param.method_name;if(!o)return e.abort();e.api=o}v(e.plugins,function(n){var t=n.before.call(n,e);if(t===!1)return n._inactive=!0,t})}},{key:"onEntry",value:function(){var n=this;v(n.plugins,function(t){t.enter.call(t,n)}),n.options.before.call(pn)}},{key:"finish",value:function(n){var t=this;v(t.plugins,function(e){return!e._inactive&&void e.finish.call(e,t,n)}),i(n),t.options.success.call(pn,n),a(function(){t.destroy()},0)}},{key:"onResponse",value:function(n){var t=this;t._inactive||t.finish(n)}},{key:"destroy",value:function(){var n=this;delete sn.handshake[n.uid];var t=["_inactive"];v(n,function(e,i){t.indexOf(i)>-1&&n._inactive||(n[i]=null,delete n[i])})}}]),e}();U("registerEvent",function(n){var t="onBDWallet";f(n,function(n){return t+u(n)});var e="pageGoBack";n.hasOwnProperty(e)&&J.android&&this.invoke(t+u(e))});var Cn={ua:"getUserAgent",qr:"callQRCodeScanner",share:"callShare",camera:"callCamera",IDPhoto:"callIDPotos",bdLogin:"bdLogin",position:"getCurrentPosition",closeWindow:"closeWindow",getContacts:"selectPhonefromAdressBook",getDeviceInfo:"getDeviceInfo",detectBankCard:"detectBankCard",jumpContactSetting:"jumpAddressBookSettings"};Cn[Q]=Q,v(Cn,function(n,t){U(t,n,function(n){n[H][n.prop](n.param,n.s,n.f)})}),v({auth:"doRnAuth",doPay:"dopay",bindCard:"doBindCard"},function(n,t){U(t,n,function(n,t){n[H][n.prop](n.s,n.f,t.param||"",!1)})});var Dn=M.location;U("login",function(n){var t=null;l(n,"function")&&(t=n,n=Dn.href),n=n||Dn.href,/^\/\/.|:\//.test(n)||(n=Dn.origin+(0===n.indexOf("/")?n:"/"+n)),this.bdLogin({param:{tpl:"bp",u:n,redirect_uri:n},success:function(e){return t?t(e):void("success"===e.type&&(M.qianbao&&M.qianbao.sync_login?M.qianbao.sync_login(Dn.host,function(){R(n)}):R(n)))}})}),U("pay",function(n,t){this.doPay({param:n,success:function(n){t(n.data)}})}),U("setMenu",function(n){l(n,"array")||(n=[n]),this[Q]({param:{method_name:"setMenu",menu_list:n.map(function(n){var t=_("s",n.callback||s,!0);return{title:n.title||"",icon:n.icon||"",callback:t}})}})}),U("setTitle",function(n){n=n||V.title;var t={method_name:"setTitle"},e=l(n);"string"==e?t.mainTitle=n:(t.mainTitle=n.mainTitle||"",t.subTitle=n.subTitle||""),this[Q]({param:t}),V.title=t.mainTitle}),U("invoke",L);var On="_a_t_",jn=M.sessionStorage,Pn={support:function(){function n(n){var t=!0;try{jn.setItem(On,1),jn.removeItem(On)}catch(e){if(n)try{t=n()}catch(n){t=!1}else t=!1}return t}return n(function(){return jn.clear(),n()})}(),set:function(n,t){Pn.support&&jn.setItem(n,F(t))},get:function(n){return Pn.support?z(jn.getItem(n)):null},remove:function(n){Pn.support&&(n?jn.removeItem(n):jn.clear())}};return N({stored:!1,before:function(n){var t=n.options,e=this;if(t.store){var i=Pn.get("a"+n.api);if(i)return e.stored=!0,n.finish(i),!1}},finish:function(n,t){var e=n.options;e.store&&!this.stored&&"success"==t.type&&Pn.set("a"+n.api,t)}}),N({timer:null,enter:function(n){var t=n.options.timeout,e=this;t>0&&(e.timer=a(function(){G(e.timer),n.abort("timeout")},t))},finish:function(){G(this.timer)}}),N({events:["getDeviceInfo","position"],traceID:0,enter:function(n){var t=this,e=n.api;if(t.events.indexOf(e)!=-1){var i=t.traceID=h();t.startTime=Date.now(),w({method_name:"doEvent",eventName:"AgentRcv",eventValues:[e,i]},$,$)}},finish:function(n){var t=this,e=t.traceID;e&&w({method_name:"doEvent",eventName:"AgentRcv",eventValues:[n.api,e,Date.now()-t.startTime]},$,$)}}),N({events:["getDeviceInfo","callPhoneInfo","callNativeField"],finish:function(n,t){if(this.events.indexOf(n.api)!=-1&&J.android)try{var e=t.data.cnt.data;e.cuid&&(e.cuid=e.cuid.substr(0,32)),e.BAIDUCUID&&(e.BAIDUCUID=q(e.BAIDUCUID))}catch(n){}}}),N({before:function(t){if(rn()||n()){var e=t.proxy;return w(t.param,e.s,e.f),!1}}}),N({before:function(n){var t=n.options,e={param:F(n.param),s:n.proxy.s,f:n.proxy.f};e.prop=n.actualApi,e[H]=M[H],n.factory(e,t)}}),f({Agent:pn}),pn.ready=B,a(function(){if(sn.devtools){var n=V.createEvent("Event");n.initEvent("agentJS_devtool_event",!0,!0),V.dispatchEvent(n)}}),pn});